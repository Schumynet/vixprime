<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Catalogo Azione</title>
  <style>
    body { background: #111; color: #eee; font-family: sans-serif; padding: 20px; }
    h1, h2 { color: #00bcd4; }
    ul { list-style: none; padding: 0; }
    li { margin: 5px 0; }
  </style>
</head>
<body>
  <h1>Genere: Azione</h1>
  <div id="generi-container">Caricamento in corso...</div>

  <script>
    const tmdbApiKey = '1e8c9083f94c62dd66fb2105cd7b613b';

    async function caricaJsonStatici() {
      const [movieRes, tvRes, episodeRes] = await Promise.all([
        fetch('tmdbidmovie.json').then(r => r.json()),
        fetch('tmdbidtv.json').then(r => r.json()),
        fetch('tmdbidepisode.json').then(r => r.json())
      ]);

      const catalogo = [
        ...movieRes.map(item => ({ ...item, type: 'movie' })),
        ...tvRes.map(item => ({ ...item, type: 'tv' })),
        ...episodeRes.map(item => ({ ...item, type: 'tv' })) // episode trattato come tv
      ];

      caricaCatalogoAzione(catalogo);
    }

    async function fetchDettagli(tmdb_id, type) {
      const tipo = type === 'movie' ? 'movie' : 'tv';
      const url = `https://api.themoviedb.org/3/${tipo}/${tmdb_id}?api_key=${tmdbApiKey}&language=it-IT`;
      try {
        const res = await fetch(url);
        return res.ok ? res.json() : null;
      } catch (e) {
        console.error(`Errore TMDB per ${tmdb_id}:`, e);
        return null;
      }
    }

    async function caricaCatalogoAzione(catalogo) {
      const azione = [];

      for (const item of catalogo) {
        const tipoEtichetta = item.type === 'movie' ? 'movie' : 'tv';
        const dati = await fetchDettagli(item.tmdb_id, item.type);
        if (dati && dati.genres?.some(g => g.name === 'Azione')) {
          azione.push({
            titolo: dati.title || dati.name,
            anno: dati.release_date?.slice(0, 4) || dati.first_air_date?.slice(0, 4),
            tipo: tipoEtichetta
          });
        }
      }

      mostraGenereAzione(azione);
    }

    function mostraGenereAzione(lista) {
      const container = document.getElementById('generi-container');
      container.innerHTML = '';

      if (lista.length === 0) {
        container.innerHTML = '<p>Nessun contenuto trovato per il genere Azione.</p>';
        return;
      }

      const sezione = document.createElement('section');
      sezione.innerHTML = `<h2>Azione</h2>`;
      const ul = document.createElement('ul');

      for (const titolo of lista) {
        const li = document.createElement('li');
        li.textContent = `${titolo.titolo} (${titolo.anno}) - ${titolo.tipo}`;
        ul.appendChild(li);
      }

      sezione.appendChild(ul);
      container.appendChild(sezione);
    }

    caricaJsonStatici();
  </script>
</body>
</html>
